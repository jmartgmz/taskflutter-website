// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../generated/client"
}

// Butterfly To-Do List Application Schema

model User {
  id                     String                   @id @default(cuid())
  email                  String                   @unique
  password               String
  firstName              String
  lastName               String
  userPoints             Int                      @default(0)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  
  // Authentication for external providers (like Auth0)
  emailVerified          DateTime?
  name                   String?
  
  // Relations
  tasks                  Task[]
  butterflyCustomizations ButterflyCustomization[]
  shopItems              ShopItem[]
  authentications        Authentication[]
}

model Authentication {
  id          String   @id @default(cuid())
  provider    String   // "auth0", "google", etc.
  providerId  String   // the sub/id from the provider
  userId      String
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([provider, providerId])
}

model Task {
  id           String      @id @default(cuid())
  userId       String
  title        String
  description  String?
  dueDate      DateTime?
  completedAt  DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  // Relations
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  butterfly    Butterfly?
  reminders    Reminder[]
}

model Butterfly {
  id             String    @id @default(cuid())
  taskId         String    @unique
  origin         String    // Where the butterfly comes from
  size           Float     // Size of the butterfly (affects points)
  isCaught       Boolean   @default(false)
  caughtAt       DateTime?
  pointsAwarded  Int       @default(0)
  createdAt      DateTime  @default(now())
  
  // Relations
  task           Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model Reminder {
  id           String       @id @default(cuid())
  taskId       String
  reminderTime DateTime
  reminderType String       // "email", "push", "sms"
  isSent       Boolean      @default(false)
  createdAt    DateTime     @default(now())
  
  // Relations
  task         Task         @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model ButterflyCustomization {
  id            String   @id @default(cuid())
  userId        String
  hatItemId     String?
  patternItemId String?
  accessoryItemId String?
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId]) // Each user can have only one active customization
}

model ShopItem {
  id              String   @id @default(cuid())
  userId          String
  itemName        String
  itemType        String   // "hat", "pattern", "accessory"
  itemColor       String
  itemCost        Int
  itemDescription String?
  isOwned         Boolean  @default(false)
  createdAt       DateTime @default(now())
  
  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
